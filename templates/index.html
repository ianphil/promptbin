{% extends "base.html" %}

{% block title %}PromptBin - Browse Prompts{% endblock %}

{% block content %}
<div class="browse-container">
    <div class="browse-header">
        <h2>Your Prompts</h2>
        {% if stats %}
        <div class="stats-summary">
            <span>{{ stats.total_prompts }} prompts total</span>
            {% if selected_category %}
            <span>| {{ stats.by_category.get(selected_category, 0) }} in {{ selected_category }}</span>
            {% endif %}
        </div>
        {% endif %}
    </div>

    <!-- Search Results Container -->
    <div id="search-results" class="search-results">
        <!-- HTMX search results will be inserted here -->
    </div>

    <!-- Prompt Grid -->
    <div class="prompt-grid" id="prompt-grid">
        {% if prompts %}
            {% for prompt in prompts %}
            <div class="prompt-card">
                <div class="prompt-header">
                    <h3>{{ prompt.title }}</h3>
                    <span class="category-badge {{ prompt.category }}">{{ prompt.category.title() }}</span>
                </div>
                <div class="prompt-preview">
                    <p>{{ prompt.description or (prompt.content[:100] + '...' if prompt.content|length > 100 else prompt.content) }}</p>
                </div>
                {% if prompt.tags %}
                <div class="prompt-tags">
                    {% for tag in prompt.tags %}
                    <span class="tag">{{ tag }}</span>
                    {% endfor %}
                </div>
                {% endif %}
                <div class="prompt-meta">
                    <span class="created-date">Created: {{ prompt.created_at[:10] }}</span>
                    <div class="prompt-actions">
                        <a href="{{ url_for('view', prompt_id=prompt.id) }}" class="btn-icon" title="View">üëÅÔ∏è</a>
                        <a href="{{ url_for('edit', prompt_id=prompt.id) }}" class="btn-icon" title="Edit">‚úèÔ∏è</a>
                        <button class="btn-icon" title="Share" onclick="sharePrompt('{{ prompt.id }}')">üîó</button>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <!-- Empty State -->
            <div class="empty-state">
                <div class="empty-icon">üìù</div>
                <h3>No Prompts Found</h3>
                {% if selected_category %}
                <p>No prompts found in the {{ selected_category }} category.</p>
                <a href="{{ url_for('index') }}" class="btn btn-secondary">View All Prompts</a>
                {% else %}
                <p>Start by creating your first prompt to organize your AI interactions.</p>
                {% endif %}
                <a href="{{ url_for('create') }}" class="btn btn-primary">Create Your First Prompt</a>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Highlight template variables in prompt previews
    document.addEventListener('DOMContentLoaded', function() {
        const previews = document.querySelectorAll('.prompt-preview p');
        previews.forEach(preview => {
            preview.innerHTML = preview.innerHTML.replace(
                /\{\{([^}]+)\}\}/g, 
                '<span class="template-var">{' + '{$1}' + '}</span>'
            );
        });
    });

    // Share prompt functionality
    function sharePrompt(promptId) {
        // For now, just copy the local URL
        const url = window.location.origin + '/view/' + promptId;
        navigator.clipboard.writeText(url).then(function() {
            showNotification('Prompt URL copied to clipboard!');
        });
    }

    // Simple notification function
    function showNotification(message) {
        const notification = document.createElement('div');
        notification.className = 'notification';
        notification.textContent = message;
        notification.style.cssText = 
            'position: fixed;' +
            'top: 20px;' +
            'right: 20px;' +
            'background: #2563eb;' +
            'color: white;' +
            'padding: 1rem;' +
            'border-radius: 0.375rem;' +
            'z-index: 1000;';
        document.body.appendChild(notification);
        
        setTimeout(function() {
            notification.remove();
        }, 3000);
    }
</script>
{% endblock %}